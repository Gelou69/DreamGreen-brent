    <!DOCTYPE html>
    <html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Order Tracking - The Little Nest</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        :root {
        --primary-color: #000000;
        --secondary-color: #333333;
        --surface-color: #e60404;
        --background-color: #f0f0f0;
        --border-color: #e0e0e0;
        --text-color: #1a1a1a;
        
        /* Status Colors - Keeping some color for a good user experience */
        --status-processing: #ffffff; /* Peach-orange */
        --status-to-ship: #ffffff; /* Gold */
        --status-to-receive: rgb(255, 255, 255); /* Blue */
        --status-completed: #ffffff; /* Green */
        }

        
        .orders-container {
        max-width: 900px;
        margin: 0 auto;
        }

        h1 {
        text-align: center;
        margin-bottom: 2rem;
        color: var(--primary-color);
        }
        
        .order-list {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        }
        
        .order-card {
        background: var(--surface-color);
        border-radius: 15px;
        border: 1px solid var(--border-color);
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        transition: box-shadow 0.3s ease;
        overflow: hidden;
        border-left-width: 5px;
        border-left-style: solid;
        }
        
        .order-card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Dynamic border colors for status */
        .order-card.status-Processing { border-left-color: rgb(255, 255, 255) var(--status-processing);  }
        .order-card.status-To-Ship { border-left-color: rgb(116, 116, 116) var(--status-to-ship); }
        .order-card.status-To-Receive { border-left-color:rgb(88, 88, 88) var(--status-to-receive); }
        .order-card.status-Completed { border-left-color: black var(--status-completed); }

        .order-summary {
            padding: 1.5rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            align-items: center;
        }

        .summary-item {
            font-size: 0.95rem;
        }
        .summary-item strong {
            display: block;
            font-size: 1.1rem;
            color: var(--secondary-color);
            margin-bottom: 0.25rem;
        }

        .order-status {
        padding: 0.3rem 1rem;
        border-radius: 20px;
        font-weight: 700;
        color: white;
        text-transform: uppercase;
        font-size: 0.8rem;
        text-align: center;
        }
        
        .status-Processing { background-color: var(--status-processing); }
        .status-To-Ship { background-color: var(--status-to-ship); }
        .status-To-Receive { background-color: var(--status-to-receive); }
        .status-Completed { background-color: var(--status-completed); }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s ease;
            justify-self: end;
        }
        .btn:hover {
            background: var(--secondary-color);
        }

        .order-items {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
        background-color: #f9f9f9;
        padding: 0 1.5rem;
        }
        
        .order-card.is-open .order-items {
        max-height: 1000px;
        padding: 1.5rem;
        border-top: 1px solid var(--border-color);
        }

        .order-item {
        display: flex;
        gap: 1rem;
        align-items: center;
        margin-bottom: 1rem;
        }

        .order-item:last-child {
            margin-bottom: 0;
        }

        .order-item img {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        }

        .item-info { flex-grow: 1; }
        .item-name { font-weight: 700; margin: 0; }
        .item-quantity { font-size: 0.9rem; color: #666; }
        .item-price { font-weight: 700; font-size: 1.1rem; text-align: right; }
        
        .order-actions {
            margin-top: 1.5rem;
            text-align: right;
        }

        .empty-message {
        text-align: center;
        font-size: 1.2rem;
        color: #666;
        margin-top: 3rem;
        }
    </style>
    </head>
    <body>
          <header>
    <div class="logo" aria-label="The Little Nest logo and tagline">
      <a href="homepage.html"><img class="logo1" src="logo-white.png" alt="The Little Nest Logo"></a>
    </div>
    <form role="search" class="search-container" aria-label="Search for products">
      <input type="search" placeholder="Search for products" aria-label="Search for products" name="search" id="searchInput" autocomplete="off" />
      <button type="submit" aria-label="Search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M21.71 20.29l-4.388-4.388A7.95 7.95 0 0016 10a8 8 0 10-8 8 7.95 7.95 0 005.907-2.678l4.388 4.388a1 1 0 001.414-1.414zM4 10a6 6 0 116 6 6 6 0 01-6-6z" />
        </svg>
      </button>
    </form>
    <div class="header-buttons" role="region" aria-label="User options and cart">
      <button class="btn-outline" aria-label="Login or Sign up" id="authBtn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm-7 8a7 7 0 0 1 14 0z" />
        </svg>
        <span>Login or Sign up</span>
      </button>
        <a href="logout.html" class="btn-outline" aria-label="Logout" id="logoutBtn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M16 13v-2H7V8l-5 4 5 4v-3zM20 3H10v2h10v14H10v2h10a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z" />
            </svg>
            Logout
        </a>
    </div>
  </header>
    <main class="orders-container" aria-labelledby="ordersHeading">
        <h1 id="ordersHeading">My Orders</h1>
        <section id="ordersList" class="order-list" aria-live="polite">
        <p class="empty-message">Loading your orders...</p>
        </section>
    </main>
  <footer aria-label="Footer">
    <div class="footer-nav" aria-label="General Site Links">
      <ul>
        <li><a href="#">About</a></li>
        <li><a href="#">DreamGreen</a></li>
        <li><a href="#">FAQâ€™s/Blog</a></li>
        <li><a href="#">Contact</a></li>
        <li><a href="#">Products</a></li>
      </ul>
    </div>
    <div class="footer-nav" aria-label="Account Links">
      <ul>
        <li><a href="#">My Account</a></li>
        <li><a href="#">My Orders</a></li>
        <li><a href="#">My Favourites</a></li>
        <li><a href="#">My Returns</a></li>
        <li><a href="#">Login</a></li>
        <li><a href="#">Terms & Conditions</a></li>
        <li><a href="#">Returns & Shipping</a></li>
      </ul>
    </div>
    <div class="logo-footer" aria-label="The Little Nest logo and tagline">
      <img class="logo2" src="logo-black.png" alt="The Little Nest Logo Black">
    </div>
    <div class="footer-contact">
      <strong>Contact Us</strong>
      <p>Talk: 0000 000 000</p>
      <p>Type: <a href="mailto:sales@thelittlenest.co.nz">sales@thelittlenest.co.nz</a></p>
      <p>View: <a href="https://www.thelittlenest.co.nz" target="_blank" rel="noopener noreferrer">www.thelittlenest.co.nz</a></p>
      <p>Visit: Marlborough, New Zealand</p>
      <div class="socials" aria-label="Social media links">
        <a href="#"><svg role="img" aria-labelledby="linkedinTitle" viewBox="0 0 24 24"><title id="linkedinTitle">LinkedIn</title><path d="M4.98 3.5C4.98 4.88 3.88 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM.52 7.5H4.5v14H.52v-14zm7.23-.02h3.76v1.92h.05c.52-1 1.8-2.04 3.7-2.04 3.95 0 4.68 2.6 4.68 5.98v6.18h-3.95v-5.48c0-1.32 0-3.02-1.84-3.02s-2.12 1.45-2.12 2.95v5.55H7.75v-14z" /></svg></a>
        <a href="#"><svg role="img" aria-labelledby="tikTokTitle" viewBox="0 0 448 512"><title id="tikTokTitle">TikTok</title><path d="M448,209.91a210.06,210.06,0,0,1-122.77-39.25V349.38A162.55,162.55,0,1,1,185,188.31V278.2a74.62,74.62,0,1,0,52.23,71.18V0l88,0a121.18,121.18,0,0,0,1.86,22.17h0A122.18,122.18,0,0,0,381,102.39a121.43,121.43,0,0,0,67,20.14Z"/></svg></a>
        <a href="#"><svg role="img" aria-labelledby="facebookTitle" viewBox="0 0 24 24"><title id="facebookTitle">Facebook</title><path d="M22.675 0h-21.35C.6 0 0 .6 0 1.341v21.317C0 23.4.6 24 1.325 24H12v-9.294H9.375v-3.622H12V8.413c0-2.58 1.574-3.993 3.873-3.993 1.102 0 2.049.082 2.326.118v2.7l-1.744.001c-1.367 0-1.63.651-1.63 1.605v2.105h3.258l-.425 3.623H15.825V24h6.85c.725 0 1.325-.6 1.325-1.342V1.341C24 .6 23.4 0 22.675 0z" /></svg></a>
        <a href="#"><svg role="img" aria-labelledby="youtubeTitle" viewBox="0 0 24 24"><title id="youtubeTitle">YouTube</title><path d="M23.498 6.186a2.954 2.954 0 0 0-2.08-2.09C19.6 3.571 12 3.571 12 3.571s-7.6 0-9.418.524a2.955 2.955 0 0 0-2.08 2.09C.021 7.986 0 12 0 12s.022 4.014.502 5.814a2.955 2.955 0 0 0 2.08 2.09C4.4 20.429 12 20.429 12 20.429s7.598 0 9.418-.525a2.955 2.955 0 0 0 2.08-2.09c.48-1.8.502-5.814.502-5.814s-.022-4.014-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" /></svg></a>
        <a href="#"><svg role="img" aria-labelledby="instagramTitle" viewBox="0 0 24 24"><title id="instagramTitle">Instagram</title><path d="M7.75 2h8.5A5.753 5.753 0 0 1 22 7.75v8.5A5.753 5.753 0 0 1 16.25 22h-8.5A5.753 5.753 0 0 1 2 16.25v-8.5A5.753 5.753 0 0 1 7.75 2zm8.5 1.5h-8.5a4.251 4.251 0 0 0-4.25 4.25v8.5a4.251 4.251 0 0 0 4.25 4.25h8.5a4.251 4.251 0 0 0 4.25-4.25v-8.5a4.251 4.251 0 0 0-4.25-4.25zm-4.25 2.87a4.38 4.38 0 1 1 0 8.76 4.38 4.38 0 0 1 0-8.76zm0 1.5a2.88 2.88 0 1 0 0 5.76 2.88 2.88 0 0 0 0-5.763zm4.634-.88a1.04 1.04 0 1 1 0 2.08 1.04 1.04 0 0 1 0-2.08z" /></svg></a>
      </div>
    </div>
  </footer>
  <div class="leave-message" tabindex="0" id="chatBtn">Leave us a message</div>
  <script src="homepage.js"></script>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        const supabaseUrl = 'https://aiwthvlhyyjplajtrhob.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpd3RodmxoeXlqcGxhanRyaG9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5NzUwNzQsImV4cCI6MjA3MjU1MTA3NH0.sjZoaEqik_YZJ_S4KDKaDAy5jlxquxzJGwvCrLPOcRQ';
        const supabase = createClient(supabaseUrl, supabaseKey);

        const ordersList = document.getElementById('ordersList');
        const authBtn = document.getElementById('authBtn');

        let currentUser = null;
        let allOrders = [];

        
async function updateAuthButton() {
    const { data: { session }, error } = await supabase.auth.getSession();
    if (error) {
        console.error('Error getting session:', error.message);
        return;
    }
    if (session && session.user) {
        // User is logged in
        const user = session.user;
        // Use user_metadata.full_name if available, else email
        const displayName = user.user_metadata?.full_name || user.email || 'User ';
        authBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm-7 8a7 7 0 0 1 14 0z" />
            </svg>
            <span>${displayName}</span>
        `;
        authBtn.onclick = async () => {
            await supabase.auth.signOut();
            window.location.reload();
        };
        authBtn.setAttribute('aria-label', `Logged in as ${displayName}. Click to log out.`);
    } else {
        // User not logged in
        authBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm-7 8a7 7 0 0 1 14 0z" />
            </svg>
            <span>Login or Sign up</span>
        `;
        authBtn.onclick = () => {
            window.location.href = 'login.html';
        };
        authBtn.setAttribute('aria-label', 'Login or Sign up');
    }
}

        function getEstimatedDelivery(status) {
        const now = new Date();
        switch (status) {
            case 'Processing':
            now.setDate(now.getDate() + 3); // 3 days to process
            break;
            case 'To Ship':
            now.setDate(now.getDate() + 5); // 5 days to ship
            break;
            case 'To Receive':
            now.setDate(now.getDate() + 2); // 2 days for last-mile delivery
            break;
            default:
            return 'Delivered';
        }
        return `by ${now.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
        }

        function renderOrders() {
        if (!allOrders || allOrders.length === 0) {
            ordersList.innerHTML = `<p class="empty-message">You haven't placed any orders yet.</p>`;
            return;
        }

        ordersList.innerHTML = allOrders.map(order => {
            const itemsHtml = order.order_items.map(item => `
            <div class="order-item">
                <img src="${item.image_url || 'placeholder.png'}" alt="${item.name}">
                <div class="item-info">
                <p class="item-name">${item.name}</p>
                <p class="item-quantity">Quantity: ${item.quantity}</p>
                </div>
                <p class="item-price">$${(item.price * item.quantity).toFixed(2)}</p>
            </div>
            `).join('');

            let actionsHtml = '';
            if (order.status === 'To Receive') {
            actionsHtml = `<div class="order-actions"><button class="btn" data-action="complete" data-order-id="${order.id}">Order Received</button></div>`;
            }
            
            const statusClass = order.status.replace(/\s+/g, '-');
            const orderDate = new Date(order.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const itemCount = order.order_items.length;
            const estimatedDelivery = getEstimatedDelivery(order.status);

            return `
            <div class="order-card status-${statusClass}" data-order-id="${order.id}">
                <div class="order-summary">
                    <div class="summary-item"><strong>Order ID</strong> #${order.id}</div>
                    <div class="summary-item"><strong>Date Placed</strong> ${orderDate}</div>
                    <div class="summary-item"><strong>Items</strong> ${itemCount}</div>
                    <div class="summary-item"><strong>Total</strong> $${order.total_amount.toFixed(2)}</div>
                    <div class="summary-item"><span class="order-status status-${statusClass}">${order.status}</span></div>
                    <div class="summary-item"><strong>Estimated Delivery</strong> ${estimatedDelivery}</div>
                    <button class="btn" data-action="toggle-details">View Details</button>
                </div>
                <div class="order-items">
                ${itemsHtml}
                ${actionsHtml}
                </div>
            </div>
            `;
        }).join('');
        }

        async function updateOrderStatus(orderId, newStatus) {
        try {
            const { error } = await supabase.from('orders').update({ status: newStatus }).eq('id', orderId);
            if (error) throw error;
            await loadOrders();
        } catch (error) {
            console.error('Error updating order status:', error);
            alert('Could not update order status.');
        }
        }

        async function checkAuth() {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
            window.location.href = 'login.html';
            return false;
        }
        currentUser = session.user;
        return true;
        }

        async function loadOrders() {
        if (!currentUser) return;
        try {
            const { data, error } = await supabase
            .from('orders')
            .select(`*, order_items(*)`)
            .eq('user_id', currentUser.id)
            .order('created_at', { ascending: false });

            if (error) throw error;
            allOrders = data;
            renderOrders();
        } catch (error) {
            console.error('Error loading orders:', error);
            ordersList.innerHTML = '<p class="empty-message">Failed to load orders.</p>';
        }
        }

        ordersList.addEventListener('click', (e) => {
        const target = e.target;
        const action = target.dataset.action;

        if (action === 'toggle-details') {
            const card = target.closest('.order-card');
            card.classList.toggle('is-open');
            target.textContent = card.classList.contains('is-open') ? 'Hide Details' : 'View Details';
        }

        if (action === 'complete') {
            const orderId = target.dataset.orderId;
            if (confirm('Have you received this order?')) {
            updateOrderStatus(orderId, 'Completed');
            }
        }
        });

        async function initializePage() {
        if (await checkAuth()) {
            await loadOrders();
        }
        }
        
        updateAuthButton();
        initializePage();
    </script>
    </body>
    </html>